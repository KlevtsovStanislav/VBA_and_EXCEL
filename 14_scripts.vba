Sub delete_not_exist_bsn_ent()
'----------------------------------------------------------------------------------------------------------------------------
'Удаление неактульных связей полей и БС
'----------------------------------------------------------------------------------------------------------------------------
Set CallerBook = ThisWorkbook
Dim TimeStamp As String
'----------------------------------------------------------------------------------------------------------------------------
Debug.Print "Открытие соединения DSN" & Now()
Dim db As ADODB.Connection
Set db = New ADODB.Connection
db.ConnectionString = "DSN=TD_RDV"
db.Open
db.CommandTimeout = 0
'----------------------------------------------------------------------------------------------------------------------------
'Указатель на номер строки
'----------------------------------------------------------------------------------------------------------------------------
rownumber = 2
'----------------------------------------------------------------------------------------------------------------------------
Do While CallerBook.Worksheets("Уд неакт св полей и БС").Cells(rownumber, 1).Value <> ""
'----------------------------------------------------------------------------------------------------------------------------
'пока нет пустой строки
'----------------------------------------------------------------------------------------------------------------------------
PBSN_ENT_ID = Worksheets("Уд неакт св полей и БС").Cells(rownumber, 1).Value                 'ID БС
PCOLUMN_ID = Worksheets("Уд неакт св полей и БС").Cells(rownumber, 3).Value                  'ID поля
'----------------------------------------------------------------------------------------------------------------------------
If PBSN_ENT_ID <> "" And PCOLUMN_ID <> "" Then
            
            SqlCode02 = "delete from PRD_DB_DMT.PLDM_COLUMN_LNK WHERE COLUMN_ID = " & PCOLUMN_ID & " AND BSN_ENT_ID = " & PBSN_ENT_ID & ";"
            db.Execute (SqlCode02)
              
End If
'----------------------------------------------------------------------------------------------------------------------------
    rownumber = rownumber + 1
'----------------------------------------------------------------------------------------------------------------------------
Loop
'----------------------------------------------------------------------------------------------------------------------------
    Range("A2:C2").Select
    Range(Selection, Selection.End(xlDown)).Select
    Selection.ClearContents
'----------------------------------------------------------------------------------------------------------------------------
    Sheets("Уд неакт св полей и БС").Select
    Selection.ListObject.QueryTable.Refresh
'----------------------------------------------------------------------------------------------------------------------------
db.Close
End Sub



